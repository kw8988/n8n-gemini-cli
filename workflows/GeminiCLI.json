{
  "name": "GeminiCLI",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "id": "43288be5-7727-4378-9f76-aa4385f04414",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [
        -224,
        96
      ],
      "webhookId": "WEBHOOK_ID_PLACEHOLDER",
      "credentials": {
        "telegramApi": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Telegram Gemini"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger\"].json.message.chat.id }}",
        "text": "={{ $json.stdout }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "Markdown"
        }
      },
      "id": "19ada9fa-d462-4e6c-ba3b-759a0c8679af",
      "name": "Telegram Reply",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        672,
        96
      ],
      "webhookId": "WEBHOOK_ID_PLACEHOLDER",
      "credentials": {
        "telegramApi": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Telegram Gemini"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// This node ensures special characters in your prompt don't break the SSH command\n// It also sets the Telegram Chat ID as the Session ID so the bot \"remembers\" you.\n\nconst prompt = $input.item.json.message.text.replace(/\"/g, '\\\\"');\nconst sessionId = $input.item.json.message.chat.id;\n\nreturn {\n  prompt,\n  sessionId\n};"
      },
      "id": "f35863f2-fc80-4f6a-aac7-4977960ef1f3",
      "name": "Sanitize & Set Session",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        192
      ]
    },
    {
      "parameters": {
        "command": "=timeout 120s gemini \"{{ $('Sanitize & Set Session').item.json.prompt }}\" --resume latest --approval-mode yolo",
        "cwd": "/path/to/workdir"
      },
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        224,
        192
      ],
      "id": "97f59005-5aa6-4639-b7e2-46c961c9cf03",
      "name": "Execute a command",
      "credentials": {
        "sshPassword": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Ubuntu SSH Password account"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "5e17e651-7f93-4e8a-8664-96d24667a423",
              "leftValue": "={{ $json.code }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals",
                "name": "filter_number_equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "4933092b-9702-4ec8-a705-1564d11da653",
      "name": "If Success",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        448,
        192
      ]
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"Telegram Trigger\"].json.message.chat.id }}",
        "text": "⚠️ **An error occurred during execution:**\n\n```\n{{ $node[\"Execute a command\"].json.stderr || $node[\"Execute a command\"].json.error }}
```",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "Markdown"
        }
      },
      "id": "3997d155-f23a-4e86-ac51-5ddc3c6c0b4b",
      "name": "Telegram Error Reply",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [
        672,
        288
      ],
      "webhookId": "WEBHOOK_ID_PLACEHOLDER",
      "credentials": {
        "telegramApi": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Telegram Gemini"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendChatAction",
        "chatId": "={{ $json.message.chat.id }}"
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        0,
        0
      ],
      "id": "5c284b58-f64a-44b5-9408-5918087558d6",
      "name": "Send a chat action",
      "webhookId": "WEBHOOK_ID_PLACEHOLDER",
      "credentials": {
        "telegramApi": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Telegram Gemini"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Sanitize & Set Session",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send a chat action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sanitize & Set Session": {
      "main": [
        [
          {
            "node": "Execute a command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a command": {
      "main": [
        [
          {
            "node": "If Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Success": {
      "main": [
        [
          {
            "node": "Telegram Reply",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Telegram Error Reply",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "VERSION_ID_PLACEHOLDER",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "INSTANCE_ID_PLACEHOLDER"
  },
  "id": "WORKFLOW_ID_PLACEHOLDER",
  "tags": []
}